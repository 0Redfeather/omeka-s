<?php
$this->htmlElement('body')->appendAttribute('class', 'modules browse');
$escape = $this->plugin('escapeHtml');
$escapeAttr = $this->plugin('escapeHtmlAttr');
?>

<h1>Modules</h1>

<form method="get" class="state-filter">
    <select name="state">
        <option value="">All Modules</option>
        <?php foreach ($states as $value => $option): ?>
        <option value="<?php echo $escapeAttr($value); ?>"<?php if ($value == $state): echo ' selected'; endif; ?>><?php echo $escape($option); ?></option>
        <?php endforeach; ?>
    </select>
</form>
<script>
$(".state-filter select").change(function() {
    $(this).closest('form').submit();
});
</script>

<?php if ($modules): ?> 
<table id="modules">
    <thead>
        <th>Module</th>
        <th>Status</th>
    </thead>
    <tbody>
        <?php foreach ($modules as $id => $module): ?>
        <tr>
            <td>
                <span class="module-name"><?php echo $this->hyperlink($module->getName(), $module->getIni('module_link')); ?></span>
                version <span class="module-version"><?php echo $module->getIni('version'); ?></span>
                <?php if ($author = $module->getIni('author')): ?>
                by <span class="module-author"><?php echo $this->hyperlink($author, $module->getIni('author_link')); ?></span>
                <?php endif; ?>

                <ul class="actions">
                    <!-- install control -->
                    <?php if ('not_installed' == $module->getState()): ?>
                    <li><a href="#" class="o-icon-install" title="Install" aria-label="Install module"></a></a></li>
                    <?php endif; ?>
                    <!-- configure control -->
                    <?php if ('active' == $module->getState() && $module->isConfigurable()): ?>
                    <li><a href="#" class="o-icon-configure" title="Configure" aria-label="Configure module"></a></li>
                    <?php endif; ?>
                    <!-- deactivate control -->
                    <?php if ('active' == $module->getState()): ?>
                    <li><a href="#" class="o-icon-deactivate" title="Deactivate" aria-label="Deactivate module"></a></li>
                    <?php endif; ?>
                    <!-- activate control -->
                    <?php if ('not_active' == $module->getState()): ?>
                    <li><a href="#" class="o-icon-activate" title="Activate" aria-label="Activate module"></a></li>
                    <?php endif; ?>
                    <!-- uninstall control -->
                    <?php if (in_array($module->getState(), array('active', 'not_active'))): ?>
                    <li><a href="#" class="o-icon-uninstall" title="Uninstall" aria-label="Uninstall module"></a></li>
                    <?php endif; ?>
                    <!-- upgrade control -->
                    <?php if ('needs_upgrade' == $module->getState()): ?>
                    <li><a href="#" class="o-icon-upgrade" title="Upgrade" aria-label="Upgrade module"></a></li>
                    <?php endif; ?>
                    <!-- more control -->
                    <li><a href="#" class="o-icon-more" title="More details" aria-label="More details"></a></li>
                </ul>
            </td>
            <td><?php echo $escape($states[$module->getState()]); ?></td>
        </tr>
        <?php endforeach; ?>
    </tbody>
</table>

<?php else: ?>

<div class="no-resources">
    <p><?php echo $escape($this->translate('Omeka could not find any modules.')); ?></p>
</div>

<?php endif; ?>
