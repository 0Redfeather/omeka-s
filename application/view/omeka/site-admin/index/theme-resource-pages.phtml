<?php
$this->htmlElement('body')->appendAttribute('class', 'sites theme-resource-pages');
$this->headScript()->appendFile($this->assetUrl('js/site-theme-resource-pages.js', 'Omeka'));
$this->headScript()->appendFile($this->assetUrl('vendor/sortablejs/Sortable.min.js', 'Omeka'));

// Get the block template for a resource page.
$getBlockTemplate = function ($resource) {
    $removeBlockText = $this->escapeHtml($this->translate('Remove block'));
    $restoreBlockText = $this->escapeHtml($this->translate('Restore block'));
    return <<<EOT
    <li class="block">
        <span class="sortable-handle"></span>
        <span class="block-layout-label"></span>
        <ul class="actions">
            <li><a href="#" class="o-icon-delete block-remove" aria-label="$removeBlockText" title="$removeBlockText"></a></li>
            <li><a href="#" class="o-icon-undo block-restore" aria-label="$restoreBlockText" title="$restoreBlockText" style="display: none;"></a></li>
        </ul>
        <input type="hidden" class="block-layout-name" name="resource_page_blocks[$resource][main][]">
    </li>
    EOT;
};
?>
<?php echo $this->pageTitle($theme->getName(), 1, $this->translate('Theme'), $this->translate('Configure resource pages')); ?>

<?php echo $this->form()->openTag($form); ?>
<?php echo $this->formCollection($form, false); ?>

<div id="page-actions">
    <?php echo $this->cancelButton(); ?>
    <button><?php echo $this->translate('Save'); ?></button>
</div>

<?php
echo $this->sectionNav([
    'item-section' => $this->translate('Item page'),
    'media-section' => $this->translate('Media page'),
    'item-set-section' => $this->translate('Item set page'),
]);
?>

<div id="item-section" class="section active">
    <ul id="item-blocks" class="blocks" data-block-template="<?php echo $this->escapeHtml($getBlockTemplate('items')); ?>"></ul>
</div>

<div id="media-section" class="section">
    <ul id="media-blocks" class="blocks" data-block-template="<?php echo $this->escapeHtml($getBlockTemplate('media')); ?>"></ul>
</div>

<div id="item-set-section" class="section">
    <ul id="item-set-blocks" class="blocks" data-block-template="<?php echo $this->escapeHtml($getBlockTemplate('item_sets')); ?>"></ul>
</div>

<?php echo $this->form()->closeTag(); ?>

<div id="item-block-selector" class="sidebar">
    <h3><?php echo $this->translate('Add a new block'); ?></h3>
    <?php foreach ($blockLayoutItems as $blockLayoutName => $blockLayout): ?>
    <button type="button" class="option" value="<?php echo $this->escapeHtml($blockLayoutName); ?>">
        <?php echo $this->translate($blockLayout->getLabel()); ?>
    </button>
    <?php endforeach; ?>
</div>

<div id="media-block-selector" class="sidebar">
    <h3><?php echo $this->translate('Add a new block'); ?></h3>
    <?php foreach ($blockLayoutMedia as $blockLayoutName => $blockLayout): ?>
    <button type="button" class="option" value="<?php echo $this->escapeHtml($blockLayoutName); ?>">
        <?php echo $this->translate($blockLayout->getLabel()); ?>
    </button>
    <?php endforeach; ?>
</div>

<div id="item-set-block-selector" class="sidebar">
    <h3><?php echo $this->translate('Add a new block'); ?></h3>
    <?php foreach ($blockLayoutItemSets as $blockLayoutName => $blockLayout): ?>
    <button type="button" class="option" value="<?php echo $this->escapeHtml($blockLayoutName); ?>">
        <?php echo $this->translate($blockLayout->getLabel()); ?>
    </button>
    <?php endforeach; ?>
</div>
